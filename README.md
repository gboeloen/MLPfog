# MLPfog

## About

MLPfog is a simple Python based package to get aquianted with machine learning classification. The classification problem used here is fog detection based on T, Td and wind synthetic data. 
1. A very simple "physical" model is used to generate the truth (target labels of "fog" or "no fog"), based on combinations of the features T, Td, wind (if Td == T and the wind does not exceed a certain threshold). 
2. The data generated by the physical model are used as training data. 
3. A Multi Layer Perceptron (MLP) - often called as Artificial Neural Network or ANN - based on the [Scikit-learn](https://scikit-learn.org/stable/modules/neural_networks_supervised.html) implementation [MLPClassifier](https://scikit-learn.org/stable/modules/generated/sklearn.neural_network.MLPClassifier.html#sklearn.neural_network.MLPClassifier) is used as a training model to learn fog detection done by the physical model. 
4. Finally, predictions based on the MLP model are generated and verified against the physical model.

## Installation

Necessary packages to run MLPfog are:

* [Numpy](https://numpy.org/)
* [Matplotlib](https://matplotlib.org/)
* [Scikit-learn](https://scikit-learn.org/stable/)

These will be installed for the user via a virtual environment by typing:

```
./create_myvenv.sh
```
Then you are all set to run MLPfog.

## Usage

### Run the model

To run MLPfog, type:

```
./driver.sh -e your_exp_name -v 0/1 -p 0/1
```
* -e your_exp_name: experiment name to be used (default is 'exp', if not specified)
* -v 0/1: switch for doing verification
* -p 0/1: switch for plotting results

### Code

The driver script will execute all steps described in the "About" section of this README. To link these steps with the python sources, see driver.sh of which the most important lines we copy here:

```
# generate training data
python generate_training_data.py

# do training
python train_mlp_model.py

# generate test data
python generate_test_data_set.py

# do prediction with physical model (truth)
python predict_set_physical_model.py

# do prediction with MLP (ANN)
python predict_set_mlp_model.py

# verify
if [[ $verify == 1 ]] ; then
   python verify_set.py
fi

# plot
if [[ $plot == 1 ]] ; then
   python plot_training_data.py
   python plot_test_data.py
   python plot_result_physical.py
   python plot_result_mlp.py
   python plot_result_mlp_verify.py
fi
```

### Output

You will get interesting printouts when running the model, however the main output is verification scores of the MLP model against the physical model. The verification is based on contingency tables, i.e. POD and FAR and [SEDI](https://journals.ametsoc.org/view/journals/wefo/26/5/waf-d-10-05030_1.xml). The corresponding figures will be saved in 
* your_exp_name/pod_far.png
* your_exp_name/sedi.png

### Experimenting with the MLP model

To play with the MLP model, edit ```src/train_mlp_model.py``` with respect to the variables 
```
doscaling
mysolver
myalpha
myarch
mymaxit
``` 
and also see the documentation of the [MLPClassifier](https://scikit-learn.org/stable/modules/generated/sklearn.neural_network.MLPClassifier.html#sklearn.neural_network.MLPClassifier) object.

### Experimenting with the data
It may be important to play also with the data generated, because information in data (features) with different properties (distribution, variance) may be more or less difficult to learn by MLP. To play with the data properties, edit ```src/generate_training_data.py``` and ```src/generate_test_data_set.py``` (the two should be consistent with each other!) with respect to the lines:
```
T = rng.normal(6., 1., days.size)
Td = rng.normal(5.9, 1.5, days.size)
wind = rng.weibull(1., days.size)
wind_threshold = 0.8
```
Also see the documentation of [numpy.random.normal](https://numpy.org/doc/stable/reference/random/generated/numpy.random.normal.html).


## Author

Gergely Boeloeni, DWD, FE22

## License

No licenses. 
